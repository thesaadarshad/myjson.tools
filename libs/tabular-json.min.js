!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.TabularJSON=n():t.TabularJSON=n()}(this,()=>(()=>{"use strict";var t={d:(n,e)=>{for(var r in e)t.o(e,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:e[r]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};function e(t,n,e){let r=t;const o=n.length-1;let c=0;for(;c<o;){const t=n[c];void 0===r[t]&&("number"==typeof n[c+1]?r[t]=[]:r[t]={}),r=r[t],c++}return r[n[o]]=e,t}function r(t){let n=0;const r=function(){const e=x();if("string"==typeof e&&t.charCodeAt(n)===N){n=0,M();const e=h();K();const r=[];for(;n<t.length;)r.push(b(e)),n<t.length&&K();return r}return e}();return void 0===r&&function(){throw new SyntaxError(`JSON value expected ${rt()}`)}(),function(){if(n<t.length)throw new SyntaxError(`Expected end of input ${rt()}`)}(),r;function h(){const r=[];let o=!0;for(;n<t.length&&t.charCodeAt(n)!==w;){o?o=!1:(G(),Q());const c=[B(U)];for(Q();n<t.length&&t.charCodeAt(n)===k;)n++,Q(),c.push(B(U)),Q();const i=c[0],f=1===c.length?(t,n)=>t[i]=n:(t,n)=>e(t,c,n);r.push({keys:c,setValue:f})}return r}function b(t){const n={};return t.forEach(({setValue:e},r)=>{const o=T();Q(),void 0!==o&&e(n,o),r<t.length-1&&(G(),Q())}),n}function x(){M();const t=T();return M(),t}function m(t){const n=x();return void 0===n&&t(),n}function T(){return function(){if(t.charCodeAt(n)===p){n++,M();const e={};let r=!0;for(;n<t.length&&t.charCodeAt(n)!==A;){if(r)r=!1;else if(G(),M(),t.charCodeAt(n)===A)break;const o=n,c=B(R);M(),H();const i=x();if(void 0===i)return void tt();Object.prototype.hasOwnProperty.call(e,c)&&!a(i,e[c])&&W(c,o+1),e[c]=i}return t.charCodeAt(n)!==A&&function(){throw new SyntaxError(`Quoted object key or end of object '}' expected ${rt()}`)}(),n++,e}}()??function(){if(t.charCodeAt(n)===g){n++,M();const e=[];let r=!0;for(;n<t.length&&t.charCodeAt(n)!==C;){if(r)r=!1;else if(G(),M(),t.charCodeAt(n)===C)break;const o=m(X);e.push(o)}return t.charCodeAt(n)!==C&&function(){throw new SyntaxError(`Array item or end of array ']' expected ${rt()}`)}(),n++,e}}()??function(){if(t.charCodeAt(n)===E&&"---"===t.substring(n,n+3)){n+=3,Q(),K();const e=h();K();const r=[];for(;n<t.length&&"---"!==t.substring(n,n+3);)r.push(b(e)),K();return"---"!==t.substring(n,n+3)&&function(){throw new SyntaxError(`Table row or end of table '---' expected ${rt()}`)}(),n+=3,r}}()??z()??function(){const e=n,r=I("inf",1/0)??I("-inf",-1/0)??I("nan",NaN);if(void 0!==r)return r;if(t.charCodeAt(n)===E&&(n++,L(e)),t.charCodeAt(n)===$)n++;else if((o=t.charCodeAt(n))>=j&&o<=O)for(n++;f(t.charCodeAt(n));)n++;var o;if(t.charCodeAt(n)===k)for(n++,L(e);f(t.charCodeAt(n));)n++;if(t.charCodeAt(n)===V||t.charCodeAt(n)===P)for(n++,t.charCodeAt(n)!==E&&t.charCodeAt(n)!==v||n++,L(e);f(t.charCodeAt(n));)n++;return n>e?parseFloat(t.slice(e,n)):void 0}()??I("true",!0)??I("false",!1)??I("null",null)}function I(e,r){if(t.slice(n,n+e.length)===e)return n+=e.length,r}function M(){for(;_()||F()||q(););}function Q(){for(;D()||F()||q(););}function _(){if(o(t.charCodeAt(n))){for(n++;o(t.charCodeAt(n));)n++;return!0}return!1}function D(){if(c(t.charCodeAt(n))){for(n++;c(t.charCodeAt(n));)n++;return!0}return!1}function F(){if(t.charCodeAt(n)===s&&t.charCodeAt(n+1)===s){for(n+=2;n<t.length&&t.charCodeAt(n)!==w;)n++;return!0}return!1}function q(){if(t.charCodeAt(n)===s&&t.charCodeAt(n+1)===y){for(n+=2;n<t.length&&t.charCodeAt(n)!==y||t.charCodeAt(n+1)!==s;)n++;return n+=2,!0}return!1}function z(){if(t.charCodeAt(n)===S){n++;let e="";for(;n<t.length&&t.charCodeAt(n)!==S;){if(t.charCodeAt(n)===d){const r=t[n+1],o=l[r];void 0!==o?(e+=o,n++):"u"===r?i(t.charCodeAt(n+2))&&i(t.charCodeAt(n+3))&&i(t.charCodeAt(n+4))&&i(t.charCodeAt(n+5))?(e+=String.fromCharCode(Number.parseInt(t.slice(n+2,n+6),16)),n+=5):nt(n):Z(n)}else u(t.charCodeAt(n))?e+=t[n]:Y(t[n]);n++}return function(){if(t.charCodeAt(n)!==S)throw new SyntaxError(`End of string '"' expected ${rt()}`)}(),n++,e}}function B(t){const n=z();return void 0===n&&t(),n}function G(){if(t.charCodeAt(n)!==N)throw new SyntaxError(`Comma ',' expected after value ${rt()}`);n++}function H(){if(t.charCodeAt(n)!==J)throw new SyntaxError(`Colon ':' expected after property name ${rt()}`);n++}function K(){if(t.charCodeAt(n)!==w)throw new SyntaxError(`Newline '\n' expected after table row ${rt()}`);M()}function L(e){if(!f(t.charCodeAt(n))){const r=t.slice(e,n);throw new SyntaxError(`Invalid number '${r}', expecting a digit ${rt()}`)}}function R(){throw new SyntaxError(`Quoted object key expected ${rt()}`)}function U(){throw new SyntaxError(`Table field expected ${rt()}`)}function W(t,n){throw new SyntaxError(`Duplicate key '${t}' encountered at position ${n}`)}function X(){throw new SyntaxError(`Array item expected ${rt()}`)}function Y(t){throw new SyntaxError(`Invalid character '${t}' ${et()}`)}function Z(n){const e=t.slice(n,n+2);throw new SyntaxError(`Invalid escape character '${e}' ${et()}`)}function tt(){throw new SyntaxError(`Object value expected after ':' ${et()}`)}function nt(n){const e=t.slice(n,n+6);throw new SyntaxError(`Invalid unicode character '${e}' ${et()}`)}function et(){return`at position ${n}`}function rt(){return`${n<t.length?`but got '${t[n]}'`:"but reached end of input"} ${et()}`}}function o(t){return t===b||t===w||t===x||t===m}function c(t){return t===b||t===x||t===m}function i(t){return t>=$&&t<=O||t>=T&&t<=M||t>=I&&t<=Q}function f(t){return t>=$&&t<=O}function u(t){return t>=32&&t<=1114111}function a(t,n){return t===n||(Array.isArray(t)&&Array.isArray(n)?t.length===n.length&&t.every((t,e)=>a(t,n[e])):!(!h(t)||!h(n))&&[...new Set([...Object.keys(t),...Object.keys(n)])].every(e=>a(t[e],n[e])))}function h(t){return"object"==typeof t&&null!==t}t.r(n),t.d(n,{parse:()=>r,stringify:()=>G});const l={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},d=92,s=47,y=42,p=123,A=125,g=91,C=93,b=32,w=10,x=9,m=13,S=34,v=43,E=45,$=48,j=49,O=57,N=44,k=46,J=58,T=65,I=97,P=69,V=101,M=70,Q=102;function _(t){return"object"==typeof t&&null!==t&&t.constructor===Object}const D=Symbol();function F(t){const n={};t.forEach(t=>{_(t)?q(t,n):z(t,n)});const e=[];return B(n,[],e),e}function q(t,n){for(const e in t){const r=t[e],o=n[e]||(n[e]=Array.isArray(r)?[]:{});_(r)?q(r,o):z(r,o)}}function z(t,n){void 0===n[D]&&(n[D]=null!=t||null)}function B(t,n,e){if(!0===t[D]||null===t[D]&&(r=t,0===Object.keys(r).length))e.push(n);else if(Array.isArray(t))t.forEach((t,r)=>B(t,n.concat(r),e));else if(_(t))for(const r in t)B(t[r],n.concat(r),e);var r}function G(t,n){const e=(r=n?.indentation,"number"==typeof r?" ".repeat(r):"string"==typeof r&&""!==r?r:void 0);var r;return function e(r,c,i){return"number"==typeof r?isNaN(r)?"nan":r===1/0?"inf":r===-1/0?"-inf":JSON.stringify(r):!0===r||!1===r||null===r?JSON.stringify(r):"string"==typeof r?K(r):"bigint"==typeof r?r.toString():function(t){return Array.isArray(t)&&t.length>0&&t.every(_)}(r)?function(n,r,c){const i=n===t,f=c&&r?r+c:r,u=c?", ":",";let a="";const h=F(n).map(t=>({name:L(t),getValue:H(t)}));a+=i?"":"---\n";const l=h.map(t=>t.name),d=n.map(t=>h.map(n=>e(n.getValue(t),f,void 0)));if(c){const t=function(t,n){return n.reduce((t,n)=>n.map((n,e)=>Math.max(t[e],n.length)),t.map(t=>t.length)).map(t=>t+2)}(l,d);a+=f+o(l,t),d.forEach(n=>a+=f+o(n,t))}else a+=f+l.join(u)+"\n",d.forEach(t=>a+=f+t.join(u)+"\n");return a+=i?"":r+"---",a}(r,c,i):Array.isArray(r)?function(t,r,o){if(0===t.length)return"[]";const c=o?r+o:r;let i=o?"[\n":"[";for(let r=0;r<t.length;r++){const f=t[r];o&&(i+=c),i+=void 0!==f&&"function"!=typeof f?e(f,c,o):"null",r<t.length-1?i+=o?",\n":",":n?.trailingCommas&&(i+=",")}return i+=o?"\n"+r+"]":"]",i}(r,c,i):_(r)?function(t,r,o){if("function"==typeof t.toJSON)return G(t.toJSON(),n);const c=Object.entries(t).filter(([t,n])=>function(t){return void 0!==t&&"function"!=typeof t&&"symbol"!=typeof t}(n));if(0===c.length)return"{}";const i=o?r+o:r;let f=o?"{\n":"{";return c.forEach(([t,r],u)=>{const a=K(t);f+=o?i+a+": ":a+":",f+=e(r,i,o),u<c.length-1?f+=o?",\n":",":n?.trailingCommas&&(f+=",")}),f+=o?"\n"+r+"}":"}",f}(r,c,i):""}(t,"",e);function o(t,n){return t.map((t,e)=>e<n.length-1?(t+",").padEnd(n[e]):t+"\n").join("")}}function H(t){if(1===t.length){const n=t[0];return t=>t[n]}return n=>function(t,n){let e=t,r=0;for(;r<n.length&&void 0!==e;)e=e?.[n[r]],r++;return e}(n,t)}function K(t){return JSON.stringify(t)}function L(t){return t.map(t=>K(String(t))).join(".")}return n})());